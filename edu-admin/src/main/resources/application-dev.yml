spring:
  # 多数据源配置（使用 dynamic-datasource）
  datasource:
    dynamic:
      primary: system  # 默认数据源
      strict: false    # 严格模式：未匹配到数据源时是否抛出异常
      # Druid 连接池配置（全局）
      druid:
        initial-size: 5
        min-idle: 5
        max-active: 20
        max-wait: 60000
        time-between-eviction-runs-millis: 60000
        min-evictable-idle-time-millis: 300000
        validation-query: SELECT 1
        test-while-idle: true
        test-on-borrow: false
        test-on-return: false
      # 数据源配置（阶段2：指向独立数据库）
      datasource:
        # 系统模块数据源
        system:
          driver-class-name: com.mysql.cj.jdbc.Driver
          url: jdbc:mysql://localhost:3306/edu_system?useUnicode=true&characterEncoding=utf8&zeroDateTimeBehavior=convertToNull&useSSL=false&serverTimezone=GMT%2B8&allowPublicKeyRetrieval=true
          username: root
          password: 123456dg
        # 学员模块数据源
        student:
          driver-class-name: com.mysql.cj.jdbc.Driver
          url: jdbc:mysql://localhost:3306/edu_student?useUnicode=true&characterEncoding=utf8&zeroDateTimeBehavior=convertToNull&useSSL=false&serverTimezone=GMT%2B8&allowPublicKeyRetrieval=true
          username: root
          password: 123456dg
        # 教学模块数据源
        teaching:
          driver-class-name: com.mysql.cj.jdbc.Driver
          url: jdbc:mysql://localhost:3306/edu_teaching?useUnicode=true&characterEncoding=utf8&zeroDateTimeBehavior=convertToNull&useSSL=false&serverTimezone=GMT%2B8&allowPublicKeyRetrieval=true
          username: root
          password: 123456dg
        # 财务模块数据源
        finance:
          driver-class-name: com.mysql.cj.jdbc.Driver
          url: jdbc:mysql://localhost:3306/edu_finance?useUnicode=true&characterEncoding=utf8&zeroDateTimeBehavior=convertToNull&useSSL=false&serverTimezone=GMT%2B8&allowPublicKeyRetrieval=true
          username: root
          password: 123456dg
        # 营销模块数据源
        marketing:
          driver-class-name: com.mysql.cj.jdbc.Driver
          url: jdbc:mysql://localhost:3306/edu_marketing?useUnicode=true&characterEncoding=utf8&zeroDateTimeBehavior=convertToNull&useSSL=false&serverTimezone=GMT%2B8&allowPublicKeyRetrieval=true
          username: root
          password: 123456dg

  # Redis 配置
  data:
    redis:
      host: localhost
      port: 6379
      password:
      database: 0
      timeout: 10000ms
      lettuce:
        pool:
          max-active: 8
          max-wait: -1ms
          max-idle: 8
          min-idle: 0

  # Flyway 配置（已禁用 - 数据库已拆分，数据已迁移）
  flyway:
    enabled: false  # 禁用 Flyway，避免与多数据源配置冲突
    # 原配置已注释，如需重新启用请参考 DATABASE_MAINTENANCE_GUIDE.md
    # baseline-on-migrate: true
    # baseline-version: 1.0.0
    # baseline-description: "Initial baseline"
    # locations: classpath:db/migration
    # table: flyway_schema_history

# 短信配置
sms:
  # 短信服务提供商：aliyun-阿里云，tencent-腾讯云
  provider: aliyun
  # 是否启用Mock模式（用于测试，不实际发送短信）
  mock-enabled: true
  # 最大重试次数
  max-retry-count: 3
  # 阿里云短信配置
  aliyun:
    access-key-id: ${ALIYUN_SMS_ACCESS_KEY_ID:your-access-key-id}
    access-key-secret: ${ALIYUN_SMS_ACCESS_KEY_SECRET:your-access-key-secret}
    sign-name: 教育管理系统
    region-id: cn-hangzhou
    endpoint: dysmsapi.aliyuncs.com
  # 腾讯云短信配置
  tencent:
    secret-id: ${TENCENT_SMS_SECRET_ID:your-secret-id}
    secret-key: ${TENCENT_SMS_SECRET_KEY:your-secret-key}
    sdk-app-id: ${TENCENT_SMS_SDK_APP_ID:your-sdk-app-id}
    sign-name: 教育管理系统
    region: ap-guangzhou

# 日志配置
logging:
  level:
    com.edu: debug
    com.edu.system: debug
    com.edu.student: debug
    com.edu.teaching: debug
    com.edu.finance: debug
    com.edu.marketing: debug
    com.edu.notification: debug
    org.springframework: info
    org.springframework.web: debug
    org.springframework.security: debug
  file:
    path: ${user.home}/logs
    name: ${user.home}/logs/edu-admin-api/application.log
  pattern:
    console: "%clr(%d{yyyy-MM-dd HH:mm:ss.SSS}){faint} %clr(%5p) %clr(${PID:- }){magenta} %clr(---){faint} %clr([%15.15t]){faint} %clr(%-40.40logger{39}){cyan} %clr(:){faint} %m%n%wEx"
    file: "%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{50} - %msg%n"

