<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.edu.finance.mapper.ContractMapper">

    <resultMap id="ContractResult" type="com.edu.finance.domain.entity.Contract">
        <id property="id" column="id"/>
        <result property="contractNo" column="contract_no"/>
        <result property="studentId" column="student_id"/>
        <result property="studentName" column="student_name"/>
        <result property="campusId" column="campus_id"/>
        <result property="campusName" column="campus_name"/>
        <result property="type" column="type"/>
        <result property="amount" column="amount"/>
        <result property="discountAmount" column="discount_amount"/>
        <result property="paidAmount" column="paid_amount"/>
        <result property="receivedAmount" column="received_amount"/>
        <result property="totalHours" column="total_hours"/>
        <result property="signDate" column="sign_date"/>
        <result property="effectiveDate" column="effective_date"/>
        <result property="expireDate" column="expire_date"/>
        <result property="status" column="status"/>
        <result property="salesId" column="sales_id"/>
        <result property="salesName" column="sales_name"/>
        <result property="remark" column="remark"/>
        <result property="createTime" column="create_time"/>
        <result property="updateTime" column="update_time"/>
    </resultMap>

    <select id="selectContractPage" resultMap="ContractResult">
        SELECT c.*,
               s.name as student_name,
               ca.name as campus_name,
               u.real_name as sales_name
        FROM fin_contract c
        LEFT JOIN stu_student s ON c.student_id = s.id
        LEFT JOIN sys_campus ca ON c.campus_id = ca.id
        LEFT JOIN sys_user u ON c.sales_id = u.id
        WHERE c.deleted = 0
        <if test="query.contractNo != null and query.contractNo != ''">
            AND c.contract_no LIKE CONCAT('%', #{query.contractNo}, '%')
        </if>
        <if test="query.studentId != null">
            AND c.student_id = #{query.studentId}
        </if>
        <if test="query.campusId != null">
            AND c.campus_id = #{query.campusId}
        </if>
        <if test="query.status != null and query.status != ''">
            AND c.status = #{query.status}
        </if>
        <if test="query.type != null and query.type != ''">
            AND c.type = #{query.type}
        </if>
        ORDER BY c.create_time DESC
    </select>

</mapper>
